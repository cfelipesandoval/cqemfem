"""
gauss_quadrature_tetra calculates the integration over an arbitrary
tetrahedron (with straight edges) using the Gaussian quadrature
integration rule
    
   loc = gauss_quadrature_tetra(nodes, order)
   I = gauss_quadrature_tetra(nodes, order, f)

   Inputs:
   f - integrating function values
   nodes - is a 4x3 array containing node locations
   order - order of the function (lowest is 4, highest is 8)
   
   Outputs:
   loc, location of interpolation points   
   I,the result of the integration

   Author:
   Ben Eng
   Refer to SYMMETRIC GAUSSIAN QUADRATURE FORMULAE FOR TETRAHEDRONAL REGIONS by Yu JINYUN
"""

import numpy as np
import scipy as sp


def gauss_quadrature_tetra(nodes, order, f=0):
    # Make the weights array
    match order:
        case 4:  # order 4
            # Array weights M = 1,4,6
            weights = np.array(
                [
                    -0.131555555555555550e-1,
                    0.762222222222222222e-2,
                    0.762222222222222222e-2,
                    0.762222222222222222e-2,
                    0.762222222222222222e-2,
                    0.248888888888888880e-1,
                    0.248888888888888880e-1,
                    0.248888888888888880e-1,
                    0.248888888888888880e-1,
                    0.248888888888888880e-1,
                    0.248888888888888880e-1,
                ]
            )

            # Array 'Alpha'
            Alpha = np.array(
                [
                    [
                        0.250000000000000000e0,
                        0.250000000000000000e0,
                        0.250000000000000000e0,
                        0.250000000000000000e0,
                    ],
                    [
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                        0.785714285714285714e0,
                    ],
                    [
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                        0.785714285714285714e0,
                        0.714285714285714285e-1,
                    ],
                    [
                        0.714285714285714285e-1,
                        0.785714285714285714e0,
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                    ],
                    [
                        0.785714285714285714e0,
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                        0.714285714285714285e-1,
                    ],
                    [
                        0.399403576166799219e0,
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                        0.100596423833200785e0,
                    ],
                    [
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                    ],
                    [
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                    ],
                    [
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                    ],
                    [
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                    ],
                    [
                        0.100596423833200785e0,
                        0.100596423833200785e0,
                        0.399403576166799219e0,
                        0.399403576166799219e0,
                    ],
                ]
            )
        case 6:  # order 6 M = 4,4,4,12
            weights = np.array(
                [
                    0.665379170969464506e-2,
                    0.665379170969464506e-2,
                    0.665379170969464506e-2,
                    0.665379170969464506e-2,
                    0.167953517588677620e-2,
                    0.167953517588677620e-2,
                    0.167953517588677620e-2,
                    0.167953517588677620e-2,
                    0.922619692394239843e-2,
                    0.922619692394239843e-2,
                    0.922619692394239843e-2,
                    0.922619692394239843e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                    0.803571428571428248e-2,
                ]
            )
            Alpha = np.array(
                [
                    [
                        0.214602871259151684,
                        0.214602871259151684,
                        0.214602871259151684,
                        0.356191386222544953,
                    ],
                    [
                        0.214602871259151684,
                        0.214602871259151684,
                        0.356191386222544953,
                        0.214602871259151684,
                    ],
                    [
                        0.214602871259151684,
                        0.356191386222544953,
                        0.214602871259151684,
                        0.214602871259151684,
                    ],
                    [
                        0.356191386222544953,
                        0.214602871259151684,
                        0.214602871259151684,
                        0.214602871259151684,
                    ],
                    [
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                        0.877978124396165982,
                    ],
                    [
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                        0.877978124396165982,
                        0.406739585346113397e-1,
                    ],
                    [
                        0.406739585346113397e-1,
                        0.877978124396165982,
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                    ],
                    [
                        0.877978124396165982,
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                        0.406739585346113397e-1,
                    ],
                    [
                        0.322337890142275646,
                        0.322337890142275646,
                        0.322337890142275646,
                        0.329863295731730594e-1,
                    ],
                    [
                        0.322337890142275646,
                        0.322337890142275646,
                        0.329863295731730594e-1,
                        0.322337890142275646,
                    ],
                    [
                        0.322337890142275646,
                        0.329863295731730594e-1,
                        0.322337890142275646,
                        0.322337890142275646,
                    ],
                    [
                        0.329863295731730594e-1,
                        0.322337890142275646,
                        0.322337890142275646,
                        0.322337890142275646,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                        0.269672331458315867,
                        0.603005664791649076,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                        0.603005664791649076,
                        0.269672331458315867,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.269672331458315867,
                        0.636610018750175299e-1,
                        0.603005664791649076,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.603005664791649076,
                        0.636610018750175299e-1,
                        0.269672331458315867,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.269672331458315867,
                        0.603005664791649076,
                        0.636610018750175299e-1,
                    ],
                    [
                        0.636610018750175299e-1,
                        0.603005664791649076,
                        0.269672331458315867,
                        0.636610018750175299e-1,
                    ],
                    [
                        0.269672331458315867,
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                        0.603005664791649076,
                    ],
                    [
                        0.603005664791649076,
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                        0.269672331458315867,
                    ],
                    [
                        0.269672331458315867,
                        0.636610018750175299e-1,
                        0.603005664791649076,
                        0.636610018750175299e-1,
                    ],
                    [
                        0.603005664791649076,
                        0.636610018750175299e-1,
                        0.269672331458315867,
                        0.636610018750175299e-1,
                    ],
                    [
                        0.269672331458315867,
                        0.603005664791649076,
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                    ],
                    [
                        0.603005664791649076,
                        0.269672331458315867,
                        0.636610018750175299e-1,
                        0.636610018750175299e-1,
                    ],
                ]
            )

        case 8:  # m =1,4,4,6,6,12,12
            weights = np.array(
                [
                    -0.393270066412926145e-1,
                    0.408131605934270525e-2,
                    0.408131605934270525e-2,
                    0.408131605934270525e-2,
                    0.408131605934270525e-2,
                    0.658086773304341943e-3,
                    0.658086773304341943e-3,
                    0.658086773304341943e-3,
                    0.658086773304341943e-3,
                    0.438425882512284693e-2,
                    0.438425882512284693e-2,
                    0.438425882512284693e-2,
                    0.438425882512284693e-2,
                    0.438425882512284693e-2,
                    0.438425882512284693e-2,
                    0.138300638425098166e-1,
                    0.138300638425098166e-1,
                    0.138300638425098166e-1,
                    0.138300638425098166e-1,
                    0.138300638425098166e-1,
                    0.138300638425098166e-1,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.424043742468372453e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                    0.223873973961420164e-2,
                ]
            )

            Alpha = np.array(
                [
                    [0.25, 0.25, 0.25, 0.25],
                    [
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                        0.617587190300082967e0,
                    ],
                    [
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                        0.617587190300082967e0,
                        0.127470936566639015e0,
                    ],
                    [
                        0.127470936566639015e0,
                        0.617587190300082967e0,
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                    ],
                    [
                        0.617587190300082967e0,
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                        0.127470936566639015e0,
                    ],
                    [
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                        0.903763508822103123e0,
                    ],
                    [
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                        0.903763508822103123e0,
                        0.320788303926322960e-1,
                    ],
                    [
                        0.320788303926322960e-1,
                        0.903763508822103123e0,
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                    ],
                    [
                        0.903763508822103123e0,
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                        0.320788303926322960e-1,
                    ],
                    [
                        0.497770956432810185e-1,
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                        0.450222904356718978e0,
                    ],
                    [
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                    ],
                    [
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                    ],
                    [
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                    ],
                    [
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                    ],
                    [
                        0.450222904356718978e0,
                        0.450222904356718978e0,
                        0.497770956432810185e-1,
                        0.497770956432810185e-1,
                    ],
                    [
                        0.183730447398549945e0,
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                        0.316269552601450060e0,
                    ],
                    [
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                    ],
                    [
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                    ],
                    [
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                    ],
                    [
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                    ],
                    [
                        0.316269552601450060e0,
                        0.316269552601450060e0,
                        0.183730447398549945e0,
                        0.183730447398549945e0,
                    ],
                    [
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                        0.513280033360881072e0,
                    ],
                    [
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                        0.229177878448171174e-1,
                    ],
                    [
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                    ],
                    [
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                    ],
                    [
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                    ],
                    [
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                    ],
                    [
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                    ],
                    [
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                    ],
                    [
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                    ],
                    [
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                    ],
                    [
                        0.229177878448171174e-1,
                        0.513280033360881072e0,
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                    ],
                    [
                        0.513280033360881072e0,
                        0.229177878448171174e-1,
                        0.231901089397150906e0,
                        0.231901089397150906e0,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                        0.193746475248804382e0,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                        0.730313427807538396e0,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                    ],
                    [
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                    ],
                    [
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                    ],
                    [
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                    ],
                    [
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                    ],
                    [
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                    ],
                    [
                        0.730313427807538396e0,
                        0.193746475248804382e0,
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                    ],
                    [
                        0.193746475248804382e0,
                        0.730313427807538396e0,
                        0.379700484718286102e-1,
                        0.379700484718286102e-1,
                    ],
                ]
            )
        case _:
            print(f"Incorrect order used")

    print("hello")
    if (isinstance(f, list) or isinstance(f, np.ndarray)):
        rArray = np.hstack((nodes, np.ones((4, 1))))

        # V is the volume of the tetrahedron given by 1/6 * det(M) which scales the weights.
        V = abs(1 / 6 * np.linalg.det(rArray))

        """
        # Assuming that Nodes is a 4x3 numpy array
        # Initialize the T matrix
        T = np.zeros((3, 3))
        
        for i in range(3):
            for j in range(3):
                T[i, j] = nodes[i, j] - nodes[3, j]
        
        for j in range(len(weights)):
            r = np.dot(T, np.transpose(Alpha[j, :3])) + np.transpose(nodes[3, :3])
            I += weights[j] * f(r[0], r[1], r[2])
        I = 6 * V * I
        """

        I = 0
        for i in range(len(weights)):
            I += weights[i] * f[i]
        I = 6 * V * I
        return I

    else:
        loc = np.empty((len(Alpha[:, 0]), 3))
        for i in range(len(Alpha[:, 0])):
            loc[i][0] = (
                nodes[0, 0] * Alpha[i, 0]
                + nodes[1, 0] * Alpha[i, 1]
                + nodes[2, 0] * Alpha[i, 2]
                + nodes[3, 0] * Alpha[i, 3]
            )
            loc[i][1] = (
                nodes[0, 1] * Alpha[i, 0]
                + nodes[1, 1] * Alpha[i, 1]
                + nodes[2, 1] * Alpha[i, 2]
                + nodes[3, 1] * Alpha[i, 3]
            )
            loc[i][2] = (
                nodes[0, 2] * Alpha[i, 0]
                + nodes[1, 2] * Alpha[i, 1]
                + nodes[2, 2] * Alpha[i, 2]
                + nodes[3, 2] * Alpha[i, 3]
            )

        return loc
