function [ I ] = quadTetra( f, Nodes, order )
% Keast, P. (1986). Moderate-degree tetrahedral quadrature formulas. 

if nargin == 2
    order = 4;
end

%% quadrature points & weights
if order == 4
% N = 4, M = 1,4,6
w = [-0.131555555555555550e-1;
     ...
      0.762222222222222222e-2;
      0.762222222222222222e-2;
      0.762222222222222222e-2;
      0.762222222222222222e-2;
     ...
      0.248888888888888880e-1;
      0.248888888888888880e-1;
      0.248888888888888880e-1;
      0.248888888888888880e-1;
      0.248888888888888880e-1;
      0.248888888888888880e-1 ];
  
Alpha = [0.250000000000000000e0,  0.250000000000000000e0,  0.250000000000000000e0,  0.250000000000000000e0;
         ...
         0.714285714285714285e-1, 0.714285714285714285e-1, 0.714285714285714285e-1, 0.785714285714285714e0;
         0.714285714285714285e-1, 0.714285714285714285e-1, 0.785714285714285714e0, 0.714285714285714285e-1;
         0.714285714285714285e-1, 0.785714285714285714e0, 0.714285714285714285e-1, 0.714285714285714285e-1;
         0.785714285714285714e0,  0.714285714285714285e-1, 0.714285714285714285e-1, 0.714285714285714285e-1;
         ...
         0.399403576166799219e0,  0.399403576166799219e0,  0.100596423833200785e0,  0.100596423833200785e0;
         0.399403576166799219e0,  0.100596423833200785e0,  0.399403576166799219e0,  0.100596423833200785e0;
         0.100596423833200785e0,  0.399403576166799219e0,  0.399403576166799219e0,  0.100596423833200785e0;
         0.399403576166799219e0,  0.100596423833200785e0,  0.100596423833200785e0,  0.399403576166799219e0;
         0.100596423833200785e0,  0.399403576166799219e0,  0.100596423833200785e0,  0.399403576166799219e0;
         0.100596423833200785e0,  0.100596423833200785e0,  0.399403576166799219e0,  0.399403576166799219e0];

elseif order == 6
% N = 6, M = 4,4,4,12
w = [0.665379170969464506e-2; 
     0.665379170969464506e-2; 
     0.665379170969464506e-2; 
     0.665379170969464506e-2; 
     ...
     0.167953517588677620e-2;
     0.167953517588677620e-2;
     0.167953517588677620e-2;
     0.167953517588677620e-2;
     ...
     0.922619692394239843e-2;
     0.922619692394239843e-2;
     0.922619692394239843e-2;
     0.922619692394239843e-2;
     ...
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2;
     0.803571428571428248e-2 ];
 
Alpha = [0.214602871259151684e0, 0.214602871259151684e0, 0.214602871259151684e0, 0.356191386222544953e0;
         0.214602871259151684e0, 0.214602871259151684e0, 0.356191386222544953e0, 0.214602871259151684e0;
         0.214602871259151684e0, 0.356191386222544953e0, 0.214602871259151684e0, 0.214602871259151684e0;
         0.356191386222544953e0, 0.214602871259151684e0, 0.214602871259151684e0, 0.214602871259151684e0;
         ...
         0.406739585346113397e-1, 0.406739585346113397e-1, 0.406739585346113397e-1, 0.877978124396165982e0;
         0.406739585346113397e-1, 0.406739585346113397e-1, 0.877978124396165982e0, 0.406739585346113397e-1;
         0.406739585346113397e-1, 0.877978124396165982e0, 0.406739585346113397e-1, 0.406739585346113397e-1;
         0.877978124396165982e0, 0.406739585346113397e-1, 0.406739585346113397e-1, 0.406739585346113397e-1;
         ...
         0.322337890142275646e0, 0.322337890142275646e0, 0.322337890142275646e0, 0.329863295731730594e-1;
         0.322337890142275646e0, 0.322337890142275646e0, 0.329863295731730594e-1, 0.322337890142275646e0;
         0.322337890142275646e0, 0.329863295731730594e-1, 0.322337890142275646e0, 0.322337890142275646e0;
         0.329863295731730594e-1, 0.322337890142275646e0, 0.322337890142275646e0, 0.322337890142275646e0;
         ...
         0.636610018750175299e-1, 0.636610018750175299e-1, 0.269672331458315867e0,  0.603005664791649076e0;
         0.636610018750175299e-1, 0.636610018750175299e-1, 0.603005664791649076e0,  0.269672331458315867e0; 
         0.636610018750175299e-1, 0.269672331458315867e0,  0.636610018750175299e-1, 0.603005664791649076e0; 
         0.636610018750175299e-1, 0.603005664791649076e0,  0.636610018750175299e-1, 0.269672331458315867e0; 
         0.636610018750175299e-1, 0.269672331458315867e0,  0.603005664791649076e0,  0.636610018750175299e-1;
         0.636610018750175299e-1, 0.603005664791649076e0,  0.269672331458315867e0,  0.636610018750175299e-1;
         0.269672331458315867e0,  0.636610018750175299e-1, 0.636610018750175299e-1, 0.603005664791649076e0; 
         0.603005664791649076e0,  0.636610018750175299e-1, 0.636610018750175299e-1, 0.269672331458315867e0; 
         0.269672331458315867e0,  0.636610018750175299e-1, 0.603005664791649076e0,  0.636610018750175299e-1;
         0.603005664791649076e0,  0.636610018750175299e-1, 0.269672331458315867e0,  0.636610018750175299e-1;
         0.269672331458315867e0,  0.603005664791649076e0,  0.636610018750175299e-1, 0.636610018750175299e-1;
         0.603005664791649076e0,  0.269672331458315867e0,  0.636610018750175299e-1, 0.636610018750175299e-1 ];

elseif order == 8
% N = 8, M = 1,4,4,6,6,12,12
w = [-0.393270066412926145e-1;
     ...
     0.408131605934270525e-2;
     0.408131605934270525e-2;
     0.408131605934270525e-2;
     0.408131605934270525e-2;
     ...
     0.658086773304341943e-3;
     0.658086773304341943e-3;
     0.658086773304341943e-3;
     0.658086773304341943e-3;
     ...
     0.438425882512284693e-2;
     0.438425882512284693e-2;
     0.438425882512284693e-2;
     0.438425882512284693e-2;
     0.438425882512284693e-2;
     0.438425882512284693e-2;
     ...
     0.138300638425098166e-1;
     0.138300638425098166e-1;
     0.138300638425098166e-1;
     0.138300638425098166e-1;
     0.138300638425098166e-1;
     0.138300638425098166e-1;
     ...
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     0.424043742468372453e-2;
     ...
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2;
     0.223873973961420164e-2];
 
Alpha = [0.25, 0.25, 0.25, 0.25;
         ...
         0.127470936566639015e0, 0.127470936566639015e0, 0.127470936566639015e0, 0.617587190300082967e0;
         0.127470936566639015e0, 0.127470936566639015e0, 0.617587190300082967e0, 0.127470936566639015e0;
         0.127470936566639015e0, 0.617587190300082967e0, 0.127470936566639015e0, 0.127470936566639015e0;
         0.617587190300082967e0, 0.127470936566639015e0, 0.127470936566639015e0, 0.127470936566639015e0;
         ...
         0.320788303926322960e-1, 0.320788303926322960e-1, 0.320788303926322960e-1, 0.903763508822103123e0;
         0.320788303926322960e-1, 0.320788303926322960e-1, 0.903763508822103123e0, 0.320788303926322960e-1;
         0.320788303926322960e-1, 0.903763508822103123e0, 0.320788303926322960e-1, 0.320788303926322960e-1;
         0.903763508822103123e0, 0.320788303926322960e-1, 0.320788303926322960e-1, 0.320788303926322960e-1;
         ...
         0.497770956432810185e-1, 0.497770956432810185e-1, 0.450222904356718978e0, 0.450222904356718978e0;
         0.497770956432810185e-1, 0.450222904356718978e0, 0.497770956432810185e-1, 0.450222904356718978e0;
         0.450222904356718978e0, 0.497770956432810185e-1, 0.497770956432810185e-1, 0.450222904356718978e0;
         0.497770956432810185e-1, 0.450222904356718978e0, 0.450222904356718978e0, 0.497770956432810185e-1;
         0.450222904356718978e0, 0.497770956432810185e-1, 0.450222904356718978e0, 0.497770956432810185e-1;
         0.450222904356718978e0, 0.450222904356718978e0, 0.497770956432810185e-1, 0.497770956432810185e-1;
         ...
         0.183730447398549945e0, 0.183730447398549945e0, 0.316269552601450060e0, 0.316269552601450060e0;
         0.183730447398549945e0, 0.316269552601450060e0, 0.183730447398549945e0, 0.316269552601450060e0;
         0.316269552601450060e0, 0.183730447398549945e0, 0.183730447398549945e0, 0.316269552601450060e0;
         0.183730447398549945e0, 0.316269552601450060e0, 0.316269552601450060e0, 0.183730447398549945e0;
         0.316269552601450060e0, 0.183730447398549945e0, 0.316269552601450060e0, 0.183730447398549945e0;
         0.316269552601450060e0, 0.316269552601450060e0, 0.183730447398549945e0, 0.183730447398549945e0;
         ...
         0.231901089397150906e0,  0.231901089397150906e0,  0.229177878448171174e-1, 0.513280033360881072e0;
         0.231901089397150906e0,  0.231901089397150906e0,  0.513280033360881072e0,  0.229177878448171174e-1;
         0.231901089397150906e0,  0.229177878448171174e-1, 0.231901089397150906e0,  0.513280033360881072e0;
         0.231901089397150906e0,  0.513280033360881072e0,  0.231901089397150906e0,  0.229177878448171174e-1;
         0.231901089397150906e0,  0.229177878448171174e-1, 0.513280033360881072e0,  0.231901089397150906e0;
         0.231901089397150906e0,  0.513280033360881072e0,  0.229177878448171174e-1, 0.231901089397150906e0;
         0.229177878448171174e-1, 0.231901089397150906e0,  0.231901089397150906e0,  0.513280033360881072e0;
         0.513280033360881072e0,  0.231901089397150906e0,  0.231901089397150906e0,  0.229177878448171174e-1;
         0.229177878448171174e-1, 0.231901089397150906e0,  0.513280033360881072e0,  0.231901089397150906e0;
         0.513280033360881072e0,  0.231901089397150906e0,  0.229177878448171174e-1, 0.231901089397150906e0;
         0.229177878448171174e-1, 0.513280033360881072e0,  0.231901089397150906e0,  0.231901089397150906e0;
         0.513280033360881072e0,  0.229177878448171174e-1, 0.231901089397150906e0,  0.231901089397150906e0;
         ...
         0.379700484718286102e-1, 0.379700484718286102e-1, 0.730313427807538396e0,  0.193746475248804382e0;
         0.379700484718286102e-1, 0.379700484718286102e-1, 0.193746475248804382e0,  0.730313427807538396e0;
         0.379700484718286102e-1, 0.730313427807538396e0,  0.379700484718286102e-1, 0.193746475248804382e0;
         0.379700484718286102e-1, 0.193746475248804382e0,  0.379700484718286102e-1, 0.730313427807538396e0;
         0.379700484718286102e-1, 0.730313427807538396e0,  0.193746475248804382e0,  0.379700484718286102e-1;
         0.379700484718286102e-1, 0.193746475248804382e0,  0.730313427807538396e0,  0.379700484718286102e-1;
         0.730313427807538396e0,  0.379700484718286102e-1, 0.379700484718286102e-1, 0.193746475248804382e0;
         0.193746475248804382e0,  0.379700484718286102e-1, 0.379700484718286102e-1, 0.730313427807538396e0;
         0.730313427807538396e0,  0.379700484718286102e-1, 0.193746475248804382e0,  0.379700484718286102e-1;
         0.193746475248804382e0,  0.379700484718286102e-1, 0.730313427807538396e0,  0.379700484718286102e-1;
         0.730313427807538396e0,  0.193746475248804382e0,  0.379700484718286102e-1, 0.379700484718286102e-1;
         0.193746475248804382e0,  0.730313427807538396e0,  0.379700484718286102e-1, 0.379700484718286102e-1 ];
end

%%
V = abs(1/6 * det([Nodes, ones(4,1)]));

T = [Nodes(1,1) - Nodes(4,1),  Nodes(2,1) - Nodes(4,1),  Nodes(3,1) - Nodes(4,1);
     Nodes(1,2) - Nodes(4,2),  Nodes(2,2) - Nodes(4,2),  Nodes(3,2) - Nodes(4,2);
     Nodes(1,3) - Nodes(4,3),  Nodes(2,3) - Nodes(4,3),  Nodes(3,3) - Nodes(4,3) ];

I = 0;
for ii = 1 : length(w)
    r = T * Alpha(ii, 1:3)' + Nodes(4,1:3)' ;
    I = I + w(ii) * f(r(1), r(2), r(3));
end
I = 6*V*I;

     
end

